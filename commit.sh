#!/bin/bash
# ä¿ç•™æ‰€æœ‰ Git å‘½ä»¤çš„è¾“å‡ºï¼ˆstdout å’Œ stderrï¼‰

# èŽ·å–æäº¤æ ‡é¢˜ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰
commit_title="$1"

# è®¾ç½®é»˜è®¤æäº¤ä¿¡æ¯ï¼ˆå¦‚æžœæœªæä¾›æ ‡é¢˜ï¼‰
if [ -z "$commit_title" ]; then
  commit_title="commit: $(date +'%Y-%m-%d %H:%M:%S')"
fi

# å®šä¹‰è¦æ‰§è¡Œçš„ Git å‘½ä»¤åºåˆ—ï¼ˆç”¨ && è¿žæŽ¥ï¼Œä»»æ„ä¸€æ­¥å¤±è´¥åˆ™ç»ˆæ­¢ï¼‰
commands=(
  'git config user.name'                # èŽ·å–/è®¾ç½®ç”¨æˆ·åï¼ˆç»§æ‰¿è¾“å‡ºï¼‰
  'git config user.email'               # èŽ·å–/è®¾ç½®é‚®ç®±ï¼ˆç»§æ‰¿è¾“å‡ºï¼‰
  'git add .'                           # æš‚å­˜æ‰€æœ‰å˜æ›´ï¼ˆç»§æ‰¿è¾“å‡ºï¼‰
  "git commit -m \"$commit_title\""     # åˆ›å»ºæäº¤ï¼ˆç»§æ‰¿è¾“å‡ºï¼‰
  'git pull'                            # æ‹‰å–è¿œç¨‹æ›´æ–°ï¼ˆç»§æ‰¿è¾“å‡ºï¼‰
  'git push'                            # æŽ¨é€æœ¬åœ°æäº¤ï¼ˆç»§æ‰¿è¾“å‡ºï¼‰
)

# æ‰§è¡Œå‘½ä»¤åºåˆ—ï¼ˆstdio ç»§æ‰¿çˆ¶è¿›ç¨‹ï¼Œä¿ç•™æ‰€æœ‰è¾“å‡ºï¼‰
try() {
  local cmd
  for cmd in "${commands[@]}"; do
    echo "ðŸš€ æ‰§è¡Œå‘½ä»¤: $cmd"  # å¯é€‰ï¼šæç¤ºå½“å‰æ‰§è¡Œçš„å‘½ä»¤ï¼ˆéžå¿…é¡»ï¼‰
    eval "$cmd" || return 1   # ä»»æ„å‘½ä»¤å¤±è´¥åˆ™ç»ˆæ­¢å¹¶è¿”å›žé”™è¯¯
  done
}

# æ•èŽ·æ‰§è¡Œç»“æžœ
if try; then
  echo "âœ… æ‰€æœ‰æ“ä½œæˆåŠŸå®Œæˆï¼"
else
  echo "âŒ æ“ä½œå¤±è´¥ï¼ˆå…·ä½“é”™è¯¯å·²åœ¨ä¸Šæ–¹è¾“å‡ºï¼‰" >&2
  exit 1
fi